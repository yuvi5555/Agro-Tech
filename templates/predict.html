{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Disease Prediction</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Montserrat', sans-serif;
            background-image: url('https://media.istockphoto.com/id/1280715716/photo/germany-stuttgart-magical-orange-sunset-sky-above-ripe-grain-field-nature-landscape-in-summer.jpg?s=612x612&w=0&k=20&c=TukToGq-LkmpxvEXEomC3d11prf_hDRSwA7pYsLYG50=');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: #ffffff; text-shadow: 1px 1px 5px rgba(0,0,0,0.5);
        }
        header { background: rgba(255,255,255,0.9); position: fixed; width: 100%; top: 0; left: 0; padding: 20px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000; }
        nav { display: flex; justify-content: center; }
        nav ul { list-style: none; display: flex; margin: 0; padding: 0; }
        nav ul li { margin: 0 15px; }
        nav ul li a { text-decoration: none; color: #333; font-weight: 600; font-size: 16px; transition: color 0.3s ease; }
        nav ul li a:hover { color: #2d962d; }

        main { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; padding: 120px 20px 60px; text-align: center; }
        main h1 { font-size: 55px; font-weight: 700; margin-bottom: 20px; text-shadow: 2px 2px 6px rgba(0,0,0,0.7); }
        main p { font-size: 20px; margin-bottom: 25px; }

        .upload-box { background: rgba(0,0,0,0.65); padding: 40px; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.6); max-width: 650px; width: 100%; }

        .file-input { display: none; }
        .file-label { display: inline-block; padding: 15px 25px; background: linear-gradient(45deg,#28a745,#218838); color:#fff; border-radius:10px; font-weight:bold; cursor:pointer; transition: all 0.3s ease; }
        .file-label:hover { background: linear-gradient(45deg,#218838,#19692c); transform: translateY(-3px); }

        .predict-btn { margin-top: 20px; display:inline-block; background: linear-gradient(45deg,#ff5722,#e64a19); color:#fff; padding:12px 35px; font-size:18px; font-weight:bold; border-radius:30px; border:none; cursor:pointer; transition: all 0.3s ease; }
        .predict-btn:hover { background: linear-gradient(45deg,#e64a19,#bf360c); transform: translateY(-4px); box-shadow: 0 8px 15px rgba(0,0,0,0.5); }

        .success-msg, .error-msg { margin-top: 20px; font-size: 18px; font-weight:600; display:none; }
        .success-msg { color:#28a745; opacity:0; transform:translateY(-20px); animation: slideFadeIn 0.8s forwards; }
        .error-msg { color:#ff4444; }

        @keyframes slideFadeIn { to { opacity:1; transform:translateY(0); } }

        .preview-img { margin-top:20px; max-width:300px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.6); display:none; }
        .result-box { margin-top:30px; padding:20px; background: rgba(255,255,255,0.95); color:#333; border-radius:15px; font-size:20px; font-weight:600; box-shadow:0 5px 15px rgba(0,0,0,0.4); display:none; opacity:0; transition:opacity 0.5s ease-in-out; }
        .result-box.show { display:block; opacity:1; }

        footer { background: rgba(0,0,0,0.8); color:white; text-align:center; padding:20px; }
        footer p { font-size:14px; }

        /* Voice support styles */
        #voice-btn { position: fixed; bottom: 20px; right: 20px; background:#007bff; color:white; border-radius:50%; width:60px; height:60px; font-size:24px; text-align:center; line-height:60px; cursor:pointer; box-shadow:0 4px 6px rgba(0,0,0,0.3); z-index:2000; }
        #language-modal { display:none; position: fixed; bottom:100px; right:20px; background:white; color:black; padding:20px; border:2px solid #007bff; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,0.2); z-index:3000; }
        #language-modal select, #language-modal button { margin:5px 0; padding:8px 12px; font-size:14px; }
    </style>
</head>

<body>
    <header>
        <nav>
            <ul>
                <li><a href="{% url 'home' %}">Home</a></li>
                <li><a href="{% url 'services' %}">Services</a></li>
                <li><a href="{% url 'about' %}">About</a></li>
                <li><a href="{% url 'contact' %}">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h1>Plant Disease Prediction</h1>
        <p>Upload a clear image of a plant leaf to detect diseases with AI assistance.</p>
        <div class="upload-box">
            <form id="predictForm" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <label for="file-upload" class="file-label">üì∑ Choose Leaf Image</label>
                <input id="file-upload" type="file" name="leaf_image" class="file-input" accept="image/*"
                    onchange="previewImage(event)">
                <br>
                <button type="submit" class="predict-btn">üîç Predict</button>
            </form>

            <!-- Success & Error messages -->
            <div id="success-msg" class="success-msg">‚úÖ Image uploaded successfully!</div>
            <div id="error-msg" class="error-msg">‚ö†Ô∏è Please choose an image first!</div>

            <!-- Preview uploaded image -->
            <img id="preview-img" src="#" alt="Uploaded Leaf" class="preview-img">

            <!-- Prediction result -->
            {% if prediction %}
            <div class="result-box show">
                üåø Prediction: <strong>{{ prediction }}</strong>
            </div>
            {% endif %}
        </div>
    </main>

    <footer>
        <p>¬© 2025 Agro Services. All rights reserved.</p>
    </footer>

    <!-- Floating Voice Button -->
    <div id="voice-btn">üîä</div>

    <!-- Language Modal -->
    <div id="language-modal">
        <h3>Choose Language</h3>
        <select id="lang-select">
            <option value="en">English</option>
            <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
            <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
        </select>
        <br><br>
        <button id="speak-btn">Translate & Read</button>
        <button id="close-btn">Close</button>
    </div>

    <!-- Google Translate Container -->
    <div id="google_translate_element" style="display:none;"></div>

    <script>
        const form = document.getElementById("predictForm");
        const fileInput = document.getElementById("file-upload");
        const successMsg = document.getElementById("success-msg");
        const errorMsg = document.getElementById("error-msg");
        const previewImg = document.getElementById("preview-img");

        window.onload = function () {
            fileInput.value = "";
            previewImg.style.display = "none";
            successMsg.style.display = "none";
            errorMsg.style.display = "none";
        };

        function previewImage(event) {
            if (event.target.files.length > 0) {
                const reader = new FileReader();
                reader.onload = function () {
                    previewImg.src = reader.result;
                    previewImg.style.display = 'block';
                    successMsg.style.display = 'block';
                    successMsg.style.animation = 'slideFadeIn 0.8s forwards';
                    errorMsg.style.display = 'none';
                };
                reader.readAsDataURL(event.target.files[0]);
            }
        }

        form.addEventListener("submit", function (e) {
            if (!fileInput.value) {
                e.preventDefault();
                errorMsg.style.display = "block";
                successMsg.style.display = "none";
                previewImg.style.display = "none";
            }
        });

        // Voice support JS
        const voiceBtn = document.getElementById("voice-btn");
        const modal = document.getElementById("language-modal");
        const speakBtn = document.getElementById("speak-btn");
        const closeBtn = document.getElementById("close-btn");
        const langSelect = document.getElementById("lang-select");
        let speech = new SpeechSynthesisUtterance();

        voiceBtn.addEventListener("click", () => { modal.style.display = "block"; });
        closeBtn.addEventListener("click", () => { modal.style.display = "none"; });

        speakBtn.addEventListener("click", () => {
            let lang = langSelect.value;
            let select = document.querySelector(".goog-te-combo");
            if(select){ select.value = lang; select.dispatchEvent(new Event("change")); }

            setTimeout(() => {
                let text = document.body.innerText;
                speech.lang = (lang==="hi")?"hi-IN":(lang==="mr")?"mr-IN":"en-US";
                speech.text = text;
                window.speechSynthesis.cancel();
                window.speechSynthesis.speak(speech);
            }, 1500);
        });
    </script>

    <!-- Google Translate Script -->
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({ pageLanguage: 'en', includedLanguages: 'en,hi,mr' }, 'google_translate_element');
        }
    </script>
    <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>

</html>
